<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>本一覧 | Procom 蔵書検索</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 8px;
        }

        img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>

<body>
    <header>
        <h1>Procom 蔵書検索</h1>
    </header>
    <main>
        <p><a href="/">ホームへ戻る</a></p>
        <section id="book-list">
            <h2 id="books-title">本一覧</h2>
            <div id="books-loading">読み込み中...</div>
            <ul id="books"></ul>
        </section>
    </main>
    <script>
    // 本一覧の描画処理
    const booksUl = document.getElementById('books');
    const loadingDiv = document.getElementById('books-loading');

    // sessionStorageから本データを取得
    let allBooks = [];
    const booksDataStr = sessionStorage.getItem('booksData');
    if (booksDataStr) {
        try {
            allBooks = JSON.parse(booksDataStr);
        } catch (e) {
            allBooks = [];
        }
    }
    displayBooks();

    // 蔵書リストを描画
    function displayBooks() {
        // ローディング表示を消す
        if (loadingDiv) loadingDiv.style.display = 'none';

        // h2タイトルの右に冊数を表示
        const booksTitle = document.getElementById('books-title');
        if (booksTitle) {
            if (Array.isArray(allBooks)) {
                booksTitle.textContent = `本一覧 (${allBooks.length}冊)`;
            } else {
                booksTitle.textContent = '本一覧 (0冊)';
            }
        }

        // データが配列であることを確認
        if (Array.isArray(allBooks) && allBooks.length > 0) {
            allBooks.forEach(book => {
                const li = document.createElement('li');
                li.style.display = 'flex';
                li.style.alignItems = 'center';
                li.style.marginBottom = '1em';

                // 画像
                const img = document.createElement('img');
                img.src = book.image || book.img || './img/NoImage.png';
                img.alt = book.title ? `${book.title} の表紙` : '本の表紙';
                img.width = 60;
                img.height = 80;
                img.style.objectFit = 'cover';
                img.style.marginRight = '1em';

                // 情報
                const infoDiv = document.createElement('div');
                const titleDiv = document.createElement('div');
                titleDiv.textContent = book.title || 'タイトル不明';
                titleDiv.style.fontWeight = 'bold';
                const authorDiv = document.createElement('div');
                authorDiv.textContent = book.author ? `著者: ${book.author}` : '';
                const publisherDiv = document.createElement('div');
                publisherDiv.textContent = book.publisher ? `出版社: ${book.publisher}` : '';
                infoDiv.appendChild(titleDiv);
                infoDiv.appendChild(authorDiv);
                infoDiv.appendChild(publisherDiv);

                li.appendChild(img);
                li.appendChild(infoDiv);
                booksUl.appendChild(li);
            });
        } else {
            booksUl.innerHTML = '<li>本が見つかりませんでした。</li>';
        }
    }
    </script>
</body>

</html>